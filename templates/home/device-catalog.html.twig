{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | Catalogue Outils de Beauté {% endblock %}
{% block description %}{{ parent() }} | Catalogue Outils de Beauté {% endblock %}
{% block keywords %}{{ parent() }} | Catalogue Outils de Beauté {% endblock %}

{% block body %}
<h2 class="pb-2">Outils de Beauté</h2>

<div class="container-fluid">
  <div class="row g-5">
    <!-- Sidebar filtres : 3 colonnes -->
    <aside class="col-lg-2 col-sm-4 bg-light p-3 rounded">
      <!-- Catégories -->
      {% if categories is defined %}
      <div class="mb-4 pt-2">
        <h4 class="d-flex justify-content-between align-items-center mb-3"
            data-bs-toggle="collapse" data-bs-target="#categoriesCollapse" aria-expanded="true">
          Catégories
          <span class="toggle-icon-categories">−</span>
        </h4>
        <div class="collapse show" id="categoriesCollapse">
          <div class="mb-2">
            <a href="{{ path('app_device') }}"
               class="text-decoration-none text-dark {% if selectedCategory is not defined %}text-success fw-bold{% endif %}">
              Toutes les catégories
            </a>
          </div>
          {% for category in categories %}
            <div class="mb-2">
              <a href="{{ path('app_device_catalog_category', {'id': category.id}) }}"
                 class="text-decoration-none text-dark {% if selectedCategory is defined and selectedCategory.id == category.id %}text-success fw-bold{% endif %}">
                {{ category.name }}
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Marques -->
      {% if brands is defined %}
      <div class="mb-4">
        <h4 class="d-flex justify-content-between align-items-center mb-3"
            data-bs-toggle="collapse" data-bs-target="#brandsCollapse" aria-expanded="false">
          Marques
          <span class="toggle-icon-brands">+</span>
        </h4>
        <div class="collapse" id="brandsCollapse">
          <div class="mb-2">
            <a href="{{ path('app_device') }}"
               class="text-decoration-none text-dark {% if selectedBrand is not defined %}text-success fw-bold{% endif %}">
              Toutes les marques
            </a>
          </div>
          {% for brand in brands %}
            <div class="mb-2">
              <a href="{{ path('app_device_catalog_brand', {'id': brand.id}) }}"
                 class="text-decoration-none text-dark {% if selectedBrand is defined and selectedBrand.id == brand.id %}text-success fw-bold{% endif %}">
                {{ brand.title }}
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Types de peau -->
      {% if skinTypes is defined %}
      <div class="mb-4">
        <h4 class="d-flex justify-content-between align-items-center mb-3"
            data-bs-toggle="collapse" data-bs-target="#skinTypesCollapse" aria-expanded="false">
          Types de peau
          <span class="toggle-icon-skin">+</span>
        </h4>
        <div class="collapse" id="skinTypesCollapse">
          <div class="mb-2">
            <a href="{{ path('app_device') }}"
               class="text-decoration-none text-dark {% if selectedSkinType is not defined %}text-success fw-bold{% endif %}">
              Tous les types
            </a>
          </div>
          {% for skinType in skinTypes %}
            <div class="mb-2">
              <a href="{{ path('app_device_catalog_skintype', {'name': skinType.title}) }}"
                 class="text-decoration-none text-dark {% if selectedSkinType is defined and selectedSkinType.title == skinType.title %}text-success fw-bold{% endif %}">
                {{ skinType.title }}
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </aside>

    <!-- Zone appareils : 9 colonnes -->
    <div class="col-lg-10 col-sm-8">
      <div class="row g-4">
        {% if devicesWithImages is empty %}
          <div class="col-12">
            <p>Aucun appareil disponible pour le moment.</p>
          </div>
        {% else %}
          {% for item in devicesWithImages %}
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100 shadow">
              {% if item.image %}
                <a class="text-decoration-none text-dark"
                   href="{{ path('app_device_catalog_show_home', {'id': item.device.id}) }}">
                  <img src="{{ asset(item.image) }}"
                       class="card-img-top"
                       alt="{{ item.device.title }}">
                </a>
              {% else %}
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center">
                  <span class="text-muted">Pas d'image</span>
                </div>
              {% endif %}

              <div class="card-body d-flex flex-column">
                <a class="text-decoration-none text-dark"
                   href="{{ path('app_device_catalog_show_home', {'id': item.device.id}) }}">
                  <h5 class="card-title">{{ item.device.title }}</h5>
                </a>
                <div class="mt-auto">
                  <div class="d-flex justify-content-end mb-2">
                    <span class="text-success fw-bold">{{ item.device.price }}€</span>
                  </div>
                  <a href="{{ path('app_cart_add', {'type': 'device', 'id': item.device.id}) }}"
                     class="btn btn-outline-success w-100">Ajouter au panier</a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-center mt-4">
    {{ knp_pagination_render(devices, '@KnpPaginator/Pagination/bootstrap_v5_pagination.html.twig') }}
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
  // Catégories
  const categoriesCollapse = document.getElementById('categoriesCollapse');
  const toggleIconCategories = document.querySelector('.toggle-icon-categories');
  if (categoriesCollapse && toggleIconCategories) {
    categoriesCollapse.addEventListener('show.bs.collapse', function () {
      toggleIconCategories.textContent = '−';
    });
    categoriesCollapse.addEventListener('hide.bs.collapse', function () {
      toggleIconCategories.textContent = '+';
    });
  }

  // Marques
  const brandsCollapse = document.getElementById('brandsCollapse');
  const toggleIconBrands = document.querySelector('.toggle-icon-brands');
  if (brandsCollapse && toggleIconBrands) {
    brandsCollapse.addEventListener('show.bs.collapse', function () {
      toggleIconBrands.textContent = '−';
    });
    brandsCollapse.addEventListener('hide.bs.collapse', function () {
      toggleIconBrands.textContent = '+';
    });
  }

  // Types de peau
  const skinTypesCollapse = document.getElementById('skinTypesCollapse');
  const toggleIconSkin = document.querySelector('.toggle-icon-skin');
  if (skinTypesCollapse && toggleIconSkin) {
    skinTypesCollapse.addEventListener('show.bs.collapse', function () {
      toggleIconSkin.textContent = '−';
    });
    skinTypesCollapse.addEventListener('hide.bs.collapse', function () {
      toggleIconSkin.textContent = '+';
    });
  }
});
</script>
{% endblock %}
